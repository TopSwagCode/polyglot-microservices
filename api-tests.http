### Polyglot Microservices API Tests
### Test all endpoints through API Gateway
### Use VS Code REST Client extension to run these tests

@gateway_host = http://localhost:8080
@content_type = application/json

### Variables (will be set from responses)
# @auth_token = will be set from login response

###
### Authentication Service Tests (via API Gateway)
###

### 1. Health Check - Test if API Gateway is running
GET {{gateway_host}}/

###

### 2. User Registration
POST {{gateway_host}}/auth/register
Content-Type: {{content_type}}

{
  "Username": "testuser{{$timestamp}}",
  "Password": "SecurePass123!"
}

###

### 3. User Registration - Duplicate user (should fail)
POST {{gateway_host}}/auth/register
Content-Type: {{content_type}}

{
  "Username": "duplicate_user",
  "Password": "SecurePass123!"
}

###

### 4. User Registration - Invalid password (should fail)
POST {{gateway_host}}/auth/register
Content-Type: {{content_type}}

{
  "Username": "invalidpass{{$timestamp}}",
  "Password": "weak"
}

###

### 5. User Login - Valid credentials
# @name login
POST {{gateway_host}}/auth/login
Content-Type: {{content_type}}

{
  "Username": "duplicate_user",
  "Password": "SecurePass123!"
}

###

### 6. User Login - Invalid credentials (should fail)
POST {{gateway_host}}/auth/login
Content-Type: {{content_type}}

{
  "Username": "nonexistent",
  "Password": "wrongpass"
}

###

### 7. Get Current User - Protected endpoint (requires JWT)
# First run the login request above to get the token
GET {{gateway_host}}/auth/me
Authorization: Bearer {{login.response.body.token}}

###

### 8. Get Current User - No token (should fail with 401)
GET {{gateway_host}}/auth/me

###

### 9. Get Current User - Invalid token (should fail with 401)
GET {{gateway_host}}/auth/me
Authorization: Bearer invalid_token_here

###

###
### Task Service Tests (via API Gateway - requires authentication)
###

### 10. Create a project - Valid token required
# @name createProject
POST {{gateway_host}}/projects
Content-Type: {{content_type}}
Authorization: Bearer {{login.response.body.token}}

{
  "name": "My First Project"
}

###

### 11. Get all projects for user
GET {{gateway_host}}/projects
Authorization: Bearer {{login.response.body.token}}

###

### 12. Get specific project
GET {{gateway_host}}/projects/{{createProject.response.body.id}}
Authorization: Bearer {{login.response.body.token}}

###

### 13. Create a task in the project
# @name createTask
POST {{gateway_host}}/tasks
Content-Type: {{content_type}}
Authorization: Bearer {{login.response.body.token}}

{
  "title": "My First Task",
  "description": "This is a test task created via API Gateway",
  "project_id": {{createProject.response.body.id}},
  "priority": "high"
}

###

### 14. Get all tasks for user
GET {{gateway_host}}/tasks
Authorization: Bearer {{login.response.body.token}}

###

### 15. Get tasks filtered by project
GET {{gateway_host}}/tasks?project_id={{createProject.response.body.id}}
Authorization: Bearer {{login.response.body.token}}

###

### 16. Get specific task
GET {{gateway_host}}/tasks/{{createTask.response.body.id}}
Authorization: Bearer {{login.response.body.token}}

###

### 17. Update task status
PUT {{gateway_host}}/tasks/{{createTask.response.body.id}}
Content-Type: {{content_type}}
Authorization: Bearer {{login.response.body.token}}

{
  "status": "completed",
  "description": "Updated task description"
}

###

### 18. Try to access tasks without authentication (should fail with 401)
GET {{gateway_host}}/tasks

###

### 19. Try to create project without authentication (should fail with 401)
POST {{gateway_host}}/projects
Content-Type: {{content_type}}

{
  "name": "Unauthorized Project"
}

###

### 20. Try to access another user's project (should fail with 404)
GET {{gateway_host}}/projects/999999
Authorization: Bearer {{login.response.body.token}}

###

###
### Future Services (Planned)
###

### Analytics Service - Get analytics
GET {{gateway_host}}/analytics/dashboard
Authorization: Bearer {{login.response.body.token}}

### Get Task Summary via API Gateway  
GET {{gateway_host}}/analytics/tasks/summary
Authorization: Bearer {{login.response.body.token}}

### Get Productivity via API Gateway
GET {{gateway_host}}/analytics/productivity
Authorization: Bearer {{login.response.body.token}}

### Get Project Analytics via API Gateway
GET {{gateway_host}}/analytics/projects/1
Authorization: Bearer {{login.response.body.token}}